\documentclass[aspectratio=169]{beamer}

\makeatletter
\appto\input@path{{pkgs/awesome-beamer},{pkgs/smile}}
\makeatother

\definecolor{dgreen}{HTML}{081c15}
\usetheme[english,color,coloraccent=dgreen,notoc,hyperref,listings]{awesome}

\usepackage[
	backend=biber,
	style=alphabetic
]{biblatex}
\usepackage[strict,autostyle]{csquotes}
\nocite{*}
\addbibresource{refs.bib}

\usetikzlibrary{tikzmark}
\def\m#1{\tikzmark{#1}}
\newcommand<>\ul[5][0pt]{\begin{tikzpicture}[o,blend mode=multiply]
	\coordinate(#5_west) at ([yshift=#1-0.25ex]pic cs:#3);
	\coordinate(#5_east) at ([yshift=#1+0.35ex]pic cs:#4);
	\fill[ul=#2,visible on=#6] (#5_west) rectangle node(#5){} (#5_east);
\end{tikzpicture}}
\tikzset{ul/.style={#1!70!black,opacity=0.40,rounded corners=.17ex}}

\usepackage{fontawesome5}
\usepackage{tikzpingus}

\usepackage[sfdefault]{FiraSans}
\usepackage{firamath-otf}
\usepackage{fontspec}
\setmonofont[
	Path = ./fonts/,
	Scale = .9,
	Extension = .ttf,
	Contextuals=Alternate,
	BoldFont={*-Bold},
	UprightFont={*-Regular},
]{Fira Code}

\usepackage[duration=25,defaulttransition=fade]{pdfpc}
\newcommand<>{\talknote}[1]{\only#2{\pdfpcnote{- #1}\relax}}

\background{uni.jpg}
\title{Constrained Zig}
\subtitle{Exploring properties of constraint programs}
\author{Lukas Pietzschmann}
\email{lukas.pietzschmann@uni-ulm.de}
\institute{Zigtoberfest}
\uni{Hochschule München}
\location{Munich}
\date{October 19$^\text{th}$, 2024}

\makeatletter
\newsavebox\avatar
\savebox\avatar{\begin{tikzpicture}
	\node[roundnode,fill=accent,inner sep=0,outer sep=0,minimum width=1.75cm+\smile@linewidth] at (0,0) {};
	\clip (0,0) circle (\dimexpr1.75cm/2\relax);
	\node at (0,0) {\includegraphics[width=1.75cm]{me.png}};
\end{tikzpicture}}

\def\link #1 to #2;{\def\ULdepth{.5pt}\def\ULthickness{.1pt}\uline{\href{#2}{#1}}}

\def\amcard#1#2#3{\begin{tikzpicture}
	\node (T) {\faCaretRight~#2};
	\node[below=1mm of T.south west,anchor=north west,text width=\textwidth/2-8.5mm,align=justify] (D) {\small#3};
	\node[roundednode,fit=(T)(D),node on layer=background,fill=lightgray!20] (F) {};
	\node[node on layer=background,anchor=north east,scale=2,opacity=0.1] at (F.north east) {#1};
\end{tikzpicture}}

\tikzset{bb/.style={draw=tcbcolframe,dash pattern=on 1mm off 1mm,dash phase=0.5mm,tcb@spec,segmentation@style}}
\def\setlinetext#1{\small\color{tcbcolframe}\contourlength{1.5pt}\contour{tcbcolback}{#1}}
\newenvironment{versusbox}[1][]{
	\begin{beamerbox}[sidebyside,segmentation code={
		\path[bb] (segmentation.north) to node[rotate=90]{\setlinetext{#1}} (segmentation.south);
	}]{gray}{}%
}{\end{beamerbox}}

\usepackage[verbatim]{lstfiracode}
\lstdefinestyle{firastyleb}{style=FiraCodeStyle,style=smile@lst@base}
\lstdefinestyle{firastylep}{style=FiraCodeStyle,style=smile@lst@plain}
\lstset{tabsize=4,style=firastylep}
\lstdefinelanguage{chr}{
	keywords={/, <=>, true}
}
\lstnewenvironment{chr}{\lstset{language=chr}}{}
\newcommand\chri[2][]{\lstinline[language=chr,#1]{#2}}

\def\signed#1{{\leavevmode\unskip\nobreak\hfil\penalty50\hskip2em
	\hbox{}\nobreak\hfil(#1)%
	\parfillskip=0pt \finalhyphendemerits=0 \endgraf}}

\newsavebox\quotebox
\newenvironment{aquote}[1]
	{\savebox\quotebox{#1}\begin{quote}}
	{\signed{\usebox\quotebox}\end{quote}}

\begin{document}

\makeatletter

\maketitle

\section{About Me}
\begin{frame}
	\frametitle{About Me}
	\begin{tikzpicture}[node distance=2mm]
		\node[roundednode,shadow,draw=none,fill=lightgray,node on layer=background,minimum width=\textwidth,minimum height=2cm] (B) {};
		\node[xshift=1.75cm/2+0.25cm] at (B.west) {\usebox\avatar};
		\node[] at (B) {\bfseries Hi, I'm Lukas!};
		\begin{scope}[scale=0.6]
			\pingu[left wing wave,heart=accent,shift={(7cm,2mm)}]
		\end{scope}

		\node[below=of B.south west,anchor=north west] (S) {\amcard{\faUniversity}{Studies}{I'm studying computer science for my master's degree at Ulm University. Currently, I'm working on my thesis.}};
		\node[below=of B.south east,anchor=north east] (I) {\amcard{\faLightbulb}{Interests}{I enjoy various things, but compilers, typesetting, and functional programming spark the most joy inside me.}};
	\end{tikzpicture}
\end{frame}

\section{Motivation}
\begin{frame}[fragile]
	\frametitle[\cite{freuder1997}]{Motivation}
	\begin{aquote}{Eugene C. Freuder}
		Constraint Programming represents one of the closest approaches computer science
		has yet made to the holy grail of programming: the user states the problem, the
		computer solves it.
	\end{aquote}\bigskip
	\lstset{xleftmargin=15mm}\begin{chr}
§\m{ps1}§min(N)§\m{pe1}§ §\m{rem1s}§\§\m{rem1e}§ §\m{ps2}§min(M)§\m{pe2}§ §\m{simpa1s}§<=>§\m{simpa1e}§ §\m{gs1}§N <= M§\m{ge1}§ | §\m{rs1}§true§\m{re1}§
	\end{chr}
	\ul<1->{blue}{ps1}{pe1}{p1}%
	\ul<1->{gray}{rem1s}{rem1e}{rem1}%
	\ul<1->{blue}{ps2}{pe2}{p2}%
	\ul<1->{gray}{simpa1s}{simpa1e}{simpa1}%
	\ul<1->{green}{gs1}{ge1}{g1}%
	\ul<1->{red}{rs1}{re1}{r1}%
	\begin{tikzpicture}[o,execute at begin node={\small}]
		\node[shift={(-4mm,-7mm)},left] at (p1) (P1) {First min constraint};
		\node[shift={(-4mm, -13mm)},left] at (rem1) (REM1) {Operation};
		\node[shift={(4mm,-13mm)},right] at (p2) (P2) {Second min constraint};
		\node[shift={(4mm,-7mm)},right] at (g1) (G1) {Guard};
		\node[shift={(4mm,-7mm)},right] at (r1) (R1) {Result};

		\draw[textarrow=blue] (P1) -| (p1);
		\draw[textarrow=gray] (REM1) -| (rem1);
		\draw[textarrow=blue] (P2) -| (p2);
		\draw[textarrow=green] (G1) -| (g1);
		\draw[textarrow=red] (R1) -| (r1);
	\end{tikzpicture}
\end{frame}

\section{CHR Syntax and Semantic}
\begin{frame}
	\frametitle[Rules]{Introduction to CHR}
	CHR knows about three kinds of rules:\par\medskip
	\begin{wide}
	\begin{columns}[c]
		\begin{column}{0.33\textwidth}
			\begin{block}[Propagation]
				\centerline{\chri{C => G | CN}}\medskip
				\chri{CN} is inferred if \chri{G} holds
			\end{block}
		\end{column}
		\begin{column}{0.33\textwidth}
			\begin{block}[Simplification]
				\centerline{\chri{C <=> G | CN}}\medskip
				\chri{CO} is simplified to \chri{CN} if \chri{G} holds
			\end{block}
		\end{column}
		\begin{column}{0.33\textwidth}
			\begin{block}[Simpagation]
				\centerline{\chri{C}$_1$ \chri{\\ C}$_2$ \chri{<=> G | CN}}\medskip
				\chri{C}$_2$ is simplified to \chri{CN} if \chri{G} holds
			\end{block}
		\end{column}
	\end{columns}
	\end{wide}\par\bigskip
	\begin{tabular}{r|l|l}
		C  & Head  & CHR Constraints                           \\
		G  & Guard & Conjunction of \m{bu1s}built-ins\m{bu1e}  \\
		CN & Body  & CHR Constraints and conjunction built-ins
	\end{tabular}
	\ul<1->{gray}{bu1s}{bu1e}{bi}\begin{tikzpicture}[o]
		\node[shift={(26mm,5mm)}] at (bi) (BI) {\small\color{darkgray}Zig expressions};
		\draw[textarrow,shorten <=0] (BI.west) to (bi_east);
	\end{tikzpicture}
	\begin{modal}<2>[Generalized Simpagation Rule]
		\hskip5mm\par Behind the curtain, the embedding represents every rule as a 4-tuple:
		\[\langle KH, RH, G, B \rangle\]
		$KH$: Kept Head\hfill$RH$: Removed Head\hfill$G$: Guard\hfill$B$: Body\par\medskip
		A propagation rule would then look like this: $\langle KH, \emptyset, G, B \rangle$
	\end{modal}
	\onslide<2>\begin{tikzpicture}[o,scale=0.5]
		\pingu[small,heart=accent,halo=blue,staff right,right wing wave,shift={(2.5cm,-1.8cm)}] at (current page.south east)
	\end{tikzpicture}
\end{frame}

\begin{frame}
	\frametitle[Constraint Store]{Introduction to CHR}
\end{frame}

\section{References}
\defbibheading{bibliography}[\bibname]{}

\begin{frame}[allowframebreaks]
	\frametitle{References}
	\printbibliography
\end{frame}
\end{document}
